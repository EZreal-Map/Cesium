# Cesium

## 1、洪水数据的预处理

> 拼接每个时刻的经纬度、R(半径)、H(水深)、S(地形高度)
>
> > 其中经纬度、R(半径)，存放在 初始文件的center.txt
>
> > 其中H(水深)、S(地形高度DEM)有多份，每一个时刻都有一份，在每个文件夹里面(如360、420、480、600...)

### 1.1、getLLRHD.py

> 读取初始时刻文件夹里面的center.txt文件、和每个时刻对应的文件夹里面的H、S文件。

在初始时刻文件夹里面生成一个subcontent.txt文件，便于JavaScript获取子目录。（PS:JavaScript不容易获取正在运行子目录）

在每一时刻文件夹里面生成一个LLRHD.txt文件，这些文件是程序主要目的，用于Cesium渲染不同时刻的洪水数据。

> LLRHD.txt每行有5列，从左到右依次是LLRHD（Longitude,Latitude,Radius,Height,DEM）

### 1.2、clearLLRHD.py

> 读取上一步在每一时刻文件夹里面生成的LLRHD.txt文件。

清除H(水深)小于阈值的数据，比如`threshold = 0.01  #阈值`，生成精简后的洪水数据文件clearLLRHD.py

### 1.3、statisticsLLRHD.py



> 共有175个时刻(文件夹),每个时刻(文件夹)有526318个网格中心点
>
> 当筛选条件为 H > 0.05时
>
> 网格平均点数：116363
> 网格最大点数：164053

![hreshold_0.0](.\flood\30jiami\0\threshold_0.05.png)

> 共有175个时刻(文件夹),每个时刻(文件夹)有526318个网格中心点
>
> 当筛选条件为 H > 0.10 时
>
> 网格平均点数：125508
> 网格最大点数：179895

![hreshold_0.0](.\flood\30jiami\0\threshold_0.01.png)

因为网格点太多了，使用1.2中的`clearLLRHD.txt`直接每次都删除上一个文件的洪水，再重新读取每个文件进行渲染，上一时刻的洪水与下一时刻的洪水中间延迟太高。因为就算只读一个`clearLLRHD.txt`需要很大的内存（>32g）和渲染时间(>30s)。

`statisticsLLRHD.py`除了统计上面的内容外，还来尝试统计每个点被使用的情况，输出保存在初始目录文件下的`count_array.txt`，接下来处理这个文件夹，来获取`常用的点`或者`所有用过点`，目的是在开始的时候，一次性初始化`所有要用的点对象`，后续每一时刻只需要遍历调整每个点对象的部分属性(height、length、color)。

## 2、Cesium进行洪水渲染