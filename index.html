<!doctype html>
<html>

<head>
    <title>张家板桥</title>
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />

    <link rel="stylesheet" type="text/css" href="./Cesium-1.96/Build/Cesium/Widgets/widgets.css">
    <script type="text/javascript" src="./Cesium-1.96/Build/Cesium/Cesium.js"></script>
    <style>
        html,
        body,
        #cesiumContainer {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }

        .cesium-widget-credits {
            display: none !important;
        }
    </style>

<body>
    <div id="cesiumcontainer" style="width:100%;height:100%"></div>

    <script type="text/javascript">
        Cesium.Ion.defaultAccessToken = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiJlODBjMmY1YS00NjZjLTQwZjUtYTVhNy05NDBiODliYWYwMzUiLCJpZCI6MTU1ODM0LCJpYXQiOjE2OTAwOTA4MTN9.s-rWLcdw5_e2j9Fz2l41ydsl23lAVJg2Q3XhThRUeRM";

        var viewer = new Cesium.Viewer("cesiumcontainer", {
            //搜索框
            geocoder: false,
            //home键
            homeButton: false,
            // 动画控件
            animation: false,
            //全屏按钮
            fullscreenButton: false,
            //场景模式选择器
            sceneModePicker: false,
            //时间轴
            timeline: false,
            //导航提示
            navigationHelpButton: false,
            //地图选择器
            baseLayerPicker: false,
            imageryProvider: new Cesium.UrlTemplateImageryProvider({
                url: "http://webst01.is.autonavi.com/appmaptile?style=6&x={x}&y={y}&z={z}",
                minimumLevel: 1,
                maximumLevel: 18
            }),
        })
        // viewer.imageryLayers.add(
        //     new Cesium.ImageryLayer(new Cesium.UrlTemplateImageryProvider({
        //         url: "https://wprd01.is.autonavi.com/appmaptile?x={x}&y={y}&z={z}&lang=zh_cn&size=1&scl=1&style=8&ltype=4",
        //         minimumLevel: 1,
        //         maximumLevel: 18
        //     }))
        // )

        viewer.terrainProvider = new Cesium.CesiumTerrainProvider({
            url: "./terrain/",
        })

        // 将视角定位到指定的经纬度
        viewer.camera.flyTo({
            destination: Cesium.Cartesian3.fromDegrees(113.39811, 31.699212, 4000.0), // 例如：1000
            orientation: {
                heading: Cesium.Math.toRadians(0.0), // 指定航向角度
                pitch: Cesium.Math.toRadians(-90.0), // 指定俯仰角度
                roll: 0.0 // 指定翻滚角度
            }
        })


        // 读取center1.txt文件并加载数据为点数据几何对象
        fetch('./flood/clearcenter1.txt')
            .then(response => response.text())
            .then(data => {
                const lines = data.split('\n');
                for (const line of lines) {
                    const [longitude, latitude, height] = line.split(',');


                    // 创建点数据几何对象
                    if (Number(height) >= 1) {
                        var pos = Cesium.Cartographic.fromDegrees(longitude, latitude);
                        Cesium.sampleTerrainMostDetailed(viewer.terrainProvider, [pos]).then(updates => {
                            console.log(updates);
                            const point = viewer.entities.add({
                                position: Cesium.Cartesian3.fromDegrees(Number(longitude), Number(latitude), Number(height) + updates[0]['height']),
                                point: {
                                    pixelSize: 1,
                                    color: Cesium.Color.RED,
                                    // outlineColor: Cesium.Color.WHITE,
                                    // outlineWidth: 2
                                },
                                // 设置高度参考为相对于地形表面
                                heightReference: Cesium.HeightReference.RELATIVE_TO_GROUND,
                            });
                        })
                    }
                    // 可以根据需要给每个点添加其他属性或操作
                    // point.name = 'Some name';
                    // point.description = 'Some description';
                }
            });
        // var pos1 = Cesium.Cartographic.fromDegrees(113.39811, 31.699212);
        // var pos2 = Cesium.Cartographic.fromDegrees(113.39811, 31.699212);
        // console.log(pos1, pos2);
        // window.setInterval(function () {
        //     Cesium.sampleTerrainMostDetailed(viewer.terrainProvider, [pos1, pos2]).then(updates => {
        //         console.log(updates);
        //     })
        // }, 1000)

    </script>
</body>

</html>